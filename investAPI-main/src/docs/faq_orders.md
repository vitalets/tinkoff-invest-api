### Для чего используется параметр `order_id` метода [PostOrder](/investAPI/orders#postorder)? 

Сейчас у нас есть два параметра с одинаковым названием:

- <code>order_id</code> как входной параметр — ключ идемпотентности в формате `UID`. Уникальность значений отслеживается только за последний месяц.
- <code>order_id</code> как выходной параметр — биржевой идентификатор заявки, который в дальнейшем используется для отслеживания статуса заявки.

Если вы используете параметр как ключ идемпотентности, многократный вызов метода [PostOrder](/investAPI/orders#postorder) с одинаковым `order_id` не приведёт к выставлению более одного торгового поручения. 

При вызове метода проверяется уникальность связки `order_id` и `account_id`:

- Если указанная пара не найдена, создаётся новое торговое поручение.
- Если связка уже есть (поручение с этим `order_id` по данному номеру счёта было выставлено раньше) — метод [PostOrder](/investAPI/orders#postorder) вернёт статус уже выставленного торгового поручения, то есть отработает согласно логике метода [GetOrderState](/investAPI/orders#getorderstate).

### Можно ли увидеть ключ идемпотентности ([`order_id`](/investAPI/orders#postorderrequest)) в операциях, выставленных поручениях и т.п.?

Сейчас `order_id` используется только как ключ идемпотентности и не прокидывается в другие сущности системы.
В будущем мы планируем добавить отображение переданного ключа в операциях.

### Сколько хранится ключ идемпотентности (`order_id`) на стороне брокера?

Ключ хранится один месяц, но пока мы не может дать гарантию его сохранности. Сейчас подразумевается полная уникальность переданного `order_id` в разрезе номера счёта — `account_id`.

### Что передавать в параметре `quantity` метода [PostOrder](/investAPI/orders#postorder)? Количество бумаг или количество лотов? <a id="4.4"></a>

Требуемое количество лотов. 

У многих инструментов [лотность](/investAPI/glossary#lot) не равна единице — учитывайте это при выставлении торговых поручений. 

### Как рассчитать полную стоимость сделки? 

Полная стоимость сделки включает в себя не только сумму операции покупки или продажи биржевого инструмента,
но и [комиссии брокера](https://www.tbank.ru/invest/help/brokerage/account/get-bs/tariff/#:~:text=%D0%9E%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8C%20%D0%B1%D1%80%D0%BE%D0%BA%D0%B5%D1%80%D1%81%D0%BA%D0%B8%D0%B9%20%D1%81%D1%87%D0%B5%D1%82-,%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5%20%D0%BA%D0%BE%D0%BC%D0%B8%D1%81%D1%81%D0%B8%D0%B8%20%D0%B5%D1%81%D1%82%D1%8C%20%D0%B2%20%D1%82%D0%B8%D0%BD%D1%8C%D0%BA%D0%BE%D1%84%D1%84%20%D0%B8%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D1%8F%D1%85%3F,-%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%BE%D1%80), сервисные комиссии, гарантийное обеспечение для операций с фьючерсами и другие параметры.

Рассчитать размеры комиссий можно из описания [вашего тарифа]((https://www.tbank.ru/invest/help/brokerage/account/get-bs/tariff/#:~:text=%D0%9E%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8C%20%D0%B1%D1%80%D0%BE%D0%BA%D0%B5%D1%80%D1%81%D0%BA%D0%B8%D0%B9%20%D1%81%D1%87%D0%B5%D1%82-,%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5%20%D0%BA%D0%BE%D0%BC%D0%B8%D1%81%D1%81%D0%B8%D0%B8%20%D0%B5%D1%81%D1%82%D1%8C%20%D0%B2%20%D1%82%D0%B8%D0%BD%D1%8C%D0%BA%D0%BE%D1%84%D1%84%20%D0%B8%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D1%8F%D1%85%3F,-%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%BE%D1%80)). Учитывайте, что комиссии берутся за сделки, а не за поручение — то есть одно торговое поручение может рождать несколько сделок. Процент комиссии фиксированный в зависимости от тарифа. 

Размер начальной и фактической комиссии можно узнать в деталях торгового поручения через метод [GetOrderState](/investAPI/orders#getorderstate).

[Подробнее про расчёт стоимости сделок с фьючерсами и облигациями](/investAPI/faq_marketdata/)

### Можно ли получить список уже исполненных торговых поручений?

Пока нет. Сейчас метод [GetOrders](/investAPI/orders#getorders) возвращает только список активных торговых
поручений — то есть поручений, которые ещё не исполнены и не отменены.

### Какие есть статусы торговых поручений и что они означают?

[Описание статусной модели торговых поручений](/investAPI/head-orders#_2)

[Алгоритм и особенности исполнения торговых поручений](/investAPI/orders_details/)

### Почему лимитная заявка исполнилась по другой цене?

Лимитное торговое поручение исполняется либо цене, указанной при её выставлении, либо по «лучшей цене»
для определённого направления сделки. 
На бирже этот механизм называется Best Execution и подразумевает исполнение торгового поручения по цене, которая выгоднее указанной в поручении. 

### Как перевести цену поручения в тип `Quotation`?

[Подробнее о конвертации](/investAPI/faq_custom_types/#quotation)

### Как изменить выставленную заявку?

Чтобы изменять уже выставленные поручения, используйте метод [replaceOrder](/investAPI/orders#replaceorder).
Через него можно отменить существующую выставленную заявку и выставить новую с изменёнными параметрами.

### Можно ли выставлять поручения по счёту Инвесткопилки? 

Нет. Если попытаться выставить поручение по счёту Инвесткопилки через метод [PostOrder](/investAPI/orders#postorder), в ответе вернётся ошибка с кодом `40004` и сообщением `Working with orders is not available with this account`. 

### Нужно ли включать маржинальную торговлю для торгов на срочном рынке? 

Да. Для выставления поручений на срочном рынке нужно включить маржинальную торговлю в приложении и терминале —
иначе вернётся ошибка `30051` из [cписка кодов ошибок](https://russianinvestments.github.io/investAPI/errors/).

### Чем отличается рыночная заявка от лимитной?

| Рыночная заявка| Лимитная заявка| 
|----------|----------|
| Заявка на покупку или продажу активов по цене, которая есть на бирже в данный момент.   | Указание брокеру, какую бумагу или валюту, сколько лотов и по какой цене вы хотите купить или продать.  | 
| Если сейчас на бирже по текущей цене торгуется меньше лотов, чем вы указали, но при этом есть другие лоты по цене, которая отличается в негативную для вас сторону — брокер купит имеющееся количество лотов по текущей цене, а оставшуюся часть заявки будет покупать по следующей по списку цене. |Для сделок покупки лимитную заявку исполнят по цене равной или дешевле той, которую вы указали. Для сделок продажи лимитную заявку исполнят по цене равной или выше той, которую вы указали.  | 
| Используйте, только когда вам срочно нужно купить или продать актив по любой цене и вы готовы к тому, что она может оказаться для вас невыгодной.   | Используйте, чтобы не тратить время на постоянное отслеживание котировок на бирже и выполнить заявку по выгодной цене.  | 

Помимо рыночных и лимитных заявок, в T-Invest API можно выставлять заявки типа [«Лучшая цена»](https://www.tbank.ru/invest/help/brokerage/account/trade-on-bs/bids/?card=q6#:~:text=%D0%BD%D0%B5%D0%B2%D1%8B%D0%B3%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9%20%D1%86%D0%B5%D0%BD%D0%B5%20%D0%BF%D0%BE%D0%BA%D1%83%D0%BF%D0%BA%D0%B8.-,%D1%87%D1%82%D0%BE%20%D1%82%D0%B0%D0%BA%D0%BE%D0%B5%20%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B0%20%C2%AB%D0%BB%D1%83%D1%87%D1%88%D0%B0%D1%8F%20%D1%86%D0%B5%D0%BD%D0%B0%C2%BB%3F,-%D0%AD%D1%82%D0%BE%20%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B0%20%D0%BD%D0%B0).

### Чем отличаются методы [GetOrders](/investAPI/orders#getorders) и [GetOrderState](/investAPI/orders#getorderstate)? 

| [GetOrders](/investAPI/orders#getorders)| [GetOrderState](/investAPI/orders#getorderstate)| 
|----------|----------|
| Предполагает получение массива активных заявок. | Предполагает получение статуса конкретной заявок по `order_id`. | 
| Возвращает только список активных торговых поручений, то есть поручений, которые ещё не исполнены и не отменены. | Возвращает торговое поручение конкретного инструмента в любом статусе, в том числе после исполнения. | 
| Максимальный срок получения частично исполненной заявки через метод — до конца торгового дня, когда все неисполненные заявки отменяются и требуют повторного выставления.  |Метод не предусмотрен для получения глубокой истории и может не возвращать информацию по поручениям, которым больше одного дня.  | 

### Существуют ли ограничения на стоимость заявки? 

Да, на данный момент такие ограничения есть. Сейчас в T-Invest API нельзя выставить заявку со стоимостью выше установленных значений для каждой из валют — её будет нужно подтверждать по СМС. Поэтому разбивайте такие заявки на заявки меньшего размера.

Если вы превысите лимит, вернётся ошибка `90003`. [Все коды ошибок](/investAPI/errors).

**Лимиты на стоимость заявки для разных валют**

| Валюта | Полное название валюты | Лимит |
|----------|----------|----------|
| RUB | Рубль  | 30 000 000   |
| USD   | Доллар США | 500 000  |
| EUR    | Евро  | 500 000  |
| GBP   | Фунт стерлингов  | 5 000 |
| CHF  | Швейцарский франк  | 5 000 |
| CNY   | Юань | 50 000 |
| JPY | Иена  | 500 000 |
| HKD  | Гонконгский доллар  | 50 000 |
| TRY   | Турецкая лира   | 50 000 |
| KZT  | Казахстанский тенге  | 500 000 |
| BYN  | Белорусский рубль | 50 000 |
| AMD   | Армянский драм  | 500 000 |
| UZS  | Узбекский сум  | 5 000 000 |
| KGS   | Киргизский сом  | 50 000 |
| TJS  | Таджикский сомони   | 50 000|
| XAU   | Золото  | 50 000 |
| XAG  | Серебро  | 50 000 |