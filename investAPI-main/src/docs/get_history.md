# Получить исторические рыночные данные в виде архива

В T-Invest API можно получить исторические рыночные данные по
инструментам за год в виде архива минутных свечей. 

Для загрузки истории котировок можно воспользоваться интерфейсом, специальным методом или подготовленными [скриптом и справочником FIGI](https://github.com/RussianInvestments/investAPI/tree/main/src/marketdata).

## Интерфейс

[Интерфейс получения истории по инструменту ](https://russianinvestments.github.io/invest-history-index-ui/#/)

На странице есть поиск по тикеру, фильтр по типу инструмента, прямые ссылки и автоматически сгенерированный скрипт для выгрузки.

Чтобы получить исторические данные, нужно ввести [токен доступа](https://russianinvestments.github.io/investAPI/token).

## Метод 

Чтобы получить исторические рыночные данные в виде архива по определённому инструменту, отправьте GET-запрос на URL `https://invest-public-api.tinkoff.ru/history-data` с указанными ниже параметрами и Bearer-токеном.

### GetHistoryRequest

| Field          | Type    | Description                                                                                  |
|:---------------|:--------|:---------------------------------------------------------------------------------------------|
| figi           | String  | [deprecated] FIGI-идентификатор инструмента, по которому запрашивается история рыночных данных |
| instrument_id  | String  | Идентификатор инструмента, принимает значения `FIGI` или `instrument_uid `                       |
| year           | Integer | Год запроса истории                                                                          |


### GetHistoryResponse

| Field | Type   | Description                                    |
|:------|:-------|:-----------------------------------------------|
| data  | Byte   | ZIP-архив исторических минутных свечей за год  |

### Пример запроса

    curl -X GET --location "https://invest-public-api.tinkoff.ru/history-data?figi=BBG00QKJSX05&year=2022" \
    -H "Authorization: Bearer token"

## Скрипт

Чтобы получить историю котировок за весь доступный период, можно воспользоваться специальным [скриптом](https://github.com/RussianInvestments/investAPI/blob/main/src/marketdata/download_md.sh) и [справочником FIGI](https://github.com/RussianInvestments/investAPI/blob/main/src/marketdata/figi.txt).

Также вы можете создать свой справочник нужных FIGI по аналогии с представленным, назвать его `figi.txt` и сохранить в той же директории, где сохраните скрипт.

Перед запуском скрипта `download_md.sh` нужно добавить [токен доступа](https://russianinvestments.github.io/investAPI/token) в параметр `token`.

### Параметры настройки скрипта `download_md.sh`

|Field| Description                                                                                               |
| :------------- |:----------------------------------------------------------------------------------------------------------|
|figi  | Имя файла *.txt с FIGI, по которым нужно получить годовые архивы исторических данных |
|token  | [Токен доступа](https://russianinvestments.github.io/investAPI/token)                                                |


### Результат работы скрипта

Когда скрипт успешно исполнен, в директорию, откуда запущен скрипт, будут сохранены ZIP-архивы. Они разбиваются по инструментам и годам исторических рыночных данных.

Порядок полей в выходном файле:

* **UID** — идентификатор инструмента.
* **UTC** — дата и время начала свечи.
* **open** — цена открытия.
* **close** — цена закрытия.
* **high** — максимальная цена за интервал.
* **low** — минимальная цена за интервал.
* **volume** — объём в лотах.

>**Важно** <br>
>Данные в архиве обновляются один раз в день — как правило, ночью. Текущего дня в архиве не будет.