## О стриме

Стрим-соединение T-Invest API для получения изменений состояния заявок.

Используется для получения событий по заявкам с момента выставления до момента исполнения или отмены. 
Переход заявки от одного статуса в другой формирует событие в стриме.

[Статусная модель заявок](/investAPI/head-orders/#_2) 

В статусе `PARTYALLY_FILL` события формируются по мере исполнения заявки.

## Особенности работы

В методе передаются все заявки по счёту из подписки, но связать заявку в стриме с поручением, которое отправлено через метод [PostOrder](/investAPI/orders/#postorder), можно не всегда.

Заявки, которые транслируются в стриме, можно идентифицировать по `order_request_id` — [ключу идемпотентности](/investAPI/head-orders/#_6). Он передаётся при [выставлении заявки](/investAPI/orders/#postorder).

Чтобы поддержать клиентский идентификатор в стриме:

- заявка должна содержать явно заданный [алгоритм исполнения](/investAPI/orders/#timeinforcetype);
- [ключ идемпотентности](/investAPI/faq_orders/#order_id-postorder_1) должен быть передан в формате UID.

### TimeInForceType

Чтобы идентифицировать заявку в стриме по ключу идемпотентности, нужно явно указать алгоритм исполнения поручения в [PostOrderRequest](/investAPI/orders/#postorderrequest).

Подходящие под условия варианты исполнения в зависимости от [типа заявки](/investAPI/orders/#ordertype):

| OrderType | TimeInForceType |
| ----- | ---- |
| `ORDER_TYPE_LIMIT`     |  Один из алгоритмов: </br> `TIME_IN_FORCE_DAY` </br> `TIME_IN_FORCE_FILL_AND_KILL` </br> `TIME_IN_FORCE_FILL_OR_KILL` </br>|
| `ORDER_TYPE_MARKET`    |  `TIME_IN_FORCE_DAY` |
| `ORDER_TYPE_BESTPRICE` | Указывать алгоритм исполнения не нужно, все bestprice-заявки маршрутизируются в стрим с ключом идемпотентности. |


>**Важно**<br>
>Если не передавать подходящий `TimeInForceType`, `order_request_id` не вернётся в сообщениях стрима. Однозначно связать выставленное поручение не получится.

### Ключ идемпотентности в формате UID

`order_request_id` в сообщениях стрима передаётся только формате UID. Если в [PostOrderRequest](/investAPI/orders/#postorderrequest) передать значение в другом формате, оно будет подменено в сообщениях стрима на сгенерированный API UID. Однозначно связать выставленное поручение не получится.

Возможные ответы стрима в зависимости от параметов, переданных в [PostOrderRequest](/investAPI/orders/#postorderrequest):

|Ключ идемпотентности| Тип исполнения|Ответы стрима|
|-|-|-|
|Не передан</br> Передан не в UID</br> Передан в UID|Не передан или не соответствует типу заявки|`order_request_id` нет в сообщениях|
|Не передан</br> Передан не в UID|Передан и соответствует типу заявки|В сообщениях `order_request_id`, сгенерированный API|
|Передан в UID|Передан и соответствует типу заявки|В сообщениях `order_request_id` из [PostOrder](/investAPI/orders/#postorder)|

## ReplaceOrder

В методе [изменения выставленной заявки](/investAPI/orders/#replaceorderrequest) пока не поддерживается новая маршрутизация. Мы доработаем это в ближайшее время.

## Сообщения стрима

### Статусы

Первое сообщение по поручению в стриме соответствует получению заявки брокером. На этом этапе ещё не определён биржевой номер заявки, в `order_id` передаётся внутренний номер.

### Состав сообщений

Некоторые параметры ответа, например, список сделок и маркер, опциональные и ориентированы на будущее развитие метода.